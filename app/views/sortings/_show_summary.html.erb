<ul class="list-group">

  <li class="list-group-item list-group-item-warning">
    <strong><%= t("return.sent_boxes") %></strong>
  </li>

  <li class="list-group-item">

    <div class="row text-center">
      <div class="col-md-3">

        <div class="row">
          <div class="col-md-6">
            <strong><%= t("offer.boxes") %></strong>
          </div>
          
            <div class="col-md-6">
              <% if @sorting.return_box.delivery.offer.event.is_lln %>
              <% else %>
                <strong><%= t("sorting.sent_cups") %></strong>
              <% end %>
            </div>

        </div>
      </div>

      <div class="col-md-9">
        <div class="row">
          <div class="col-md-2">
            <strong><%= t("sorting.clean_return") %></strong>
          </div>         
          <div class="col-md-2">
            <strong><%= t("sorting.clean") %></strong>
          </div>
          <div class="col-md-2">
            <strong><%= t("sorting.very_dirty") %></strong>  
          </div>
          <div class="col-md-2">
            <strong><%= t("sorting.broken") %></strong>
          </div>

          <div class="col-md-2">
            <strong><%= t("sorting.handling") %></strong>
          </div>

          <div class="col-md-2">
           <strong><%= t("sorting.missing") %></strong>
          </div>

        </div>
      </div>
    </div>

  </li>

    <% @sorting.return_box.delivery.offer.offer_boxes.each do |offer_box| %>

      <li class="list-group-item">
        <div class="row text-center">
          <div class="col-md-3">

            <div class="row">
              <div class="col-md-6">
                <%= offer_box.box.boxdetails.last.article.full_name %><br>
                <%= offer_box.quantity if offer_box.quantity %> <%= t("offer.boxes") %>
              </div>
              <div class="col-md-6">
                <% if @sorting.return_box.delivery.offer.event.is_lln %>
                <% else %>
                  <%= offer_box.quantity * offer_box.box.boxdetails.last.box_article_quantity %> <%= t("offer.cups") %><br>
                <% end %>
              </div>
            </div>
          </div>

          <div class="col-md-9">
            <div class="row">
              <div class="col-md-2">
                <% if @sorting.return_details.where(:box_id => offer_box.box_id).any? %>

                  <%= @sorting.return_details.where(:box_id => offer_box.box_id).sum("clean") * @sorting.return_details.where(:box_id => offer_box.box_id).last.box.boxdetails.last.box_article_quantity %>

                <% else %>
                  <%= 0 * 0 %>
                <% end %>

              </div>  
              <div class="col-md-2">
                <%= @sorting.global_clean_sum(offer_box.box.boxdetails.last.article) %>
              </div>
              <div class="col-md-2">
                <%= @sorting.global_very_dirty_sum(offer_box.box.boxdetails.last.article) %>
              </div>
              <div class="col-md-2">
                <%= @sorting.global_broken_sum(offer_box.box.boxdetails.last.article) %> 
              </div>

              <div class="col-md-2">
                <%= @sorting.global_handling_sum(offer_box.box.boxdetails.last.article) %>
              </div>

              <div class="col-md-2">

                <% if @sorting.return_box.delivery.offer.event.is_lln %>
                <% else %>

                  <% if @sorting.return_details.where(:box_id => offer_box.box_id).any? %>

                    <%= (offer_box.quantity * offer_box.box.boxdetails.last.box_article_quantity) - @sorting.global_clean_sum(offer_box.box.boxdetails.last.article) - @sorting.global_very_dirty_sum(offer_box.box.boxdetails.last.article) - @sorting.global_handling_sum(offer_box.box.boxdetails.last.article) - (@sorting.return_details.where(:box_id => offer_box.box_id).sum("clean") * @sorting.return_details.where(:box_id => offer_box.box_id).last.box.boxdetails.last.box_article_quantity) %>

                  <% else %>

                    <%= (offer_box.quantity * offer_box.box.boxdetails.last.box_article_quantity) - @sorting.global_clean_sum(offer_box.box.boxdetails.last.article) - @sorting.global_very_dirty_sum(offer_box.box.boxdetails.last.article) - @sorting.global_handling_sum(offer_box.box.boxdetails.last.article) %>

                  <% end %>
                <% end %>
              </div>

            </div>
          </div>
        </div>
      </li>
    <% end %>

  <li class="list-group-item list-group-item-warning">
    <strong>Articles revenus sans Ãªtre partis</strong>
  </li>



  <li class="list-group-item">

    <div class="row text-center">
      <div class="col-md-3">

        <div class="row">
          <div class="col-md-6">
            <strong><%= t("offer.cups") %></strong>
          </div>
          <div class="col-md-6">
            
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <div class="row">     
          <div class="col-md-2">
            <strong><%= t("sorting.clean") %></strong>
          </div>
          <div class="col-md-2">
            <strong><%= t("sorting.very_dirty") %></strong>  
          </div>
          <div class="col-md-2">
            <strong><%= t("sorting.broken") %></strong>
          </div>

          <div class="col-md-2">
            <strong><%= t("sorting.handling") %></strong>
          </div>

          <div class="col-md-4">
           <strong><%= t("sorting.missing") %></strong>
          </div>

        </div>
      </div>
    </div>

  </li>

  <% @articles.each do |article| %>

    <% if @sorting.return_box.delivery.offer.articles.include?(article) %>
    <% else %>

      <% if @sorting.articles.include?(article) %>

        <li class="list-group-item">
          <div class="row text-center">
            <div class="col-md-3">

              <div class="row">
                <div class="col-md-6">
                  <%= article.full_name %>
                  
                </div>
                <div class="col-md-6">

                </div>
              </div>
            </div>

            <div class="col-md-9">
              <div class="row">     
                <div class="col-md-2">
                  <%= @sorting.global_clean_sum(article) %>
                </div>
                <div class="col-md-2">
                  <%= @sorting.global_very_dirty_sum(article) %>
                </div>
                <div class="col-md-2">
                  <%= @sorting.global_broken_sum(article) %>
                </div>

                <div class="col-md-2">
                  <%= @sorting.global_handling_sum(article) %>
                </div>

                <div class="col-md-4">
                  <%= 0 - @sorting.global_clean_sum(article) - @sorting.global_very_dirty_sum(article) - @sorting.global_handling_sum(article) %>
                </div>

              </div>
            </div>
          </div>
        </li>

      <% end %>
    <% end %>
  <% end %>
</ul>